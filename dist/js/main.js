$(function(){$(document).keyup(function(e){var keycode=e.keyCode?e.keyCode:e.which;if(keycode=="13")return;var sentence="AFT YEAR END PARTY 2018 (^_^)";if(keycode=="49")sentence="Macbook Pro 15' 256G";if(keycode=="50")sentence="Macbook Pro 13' 512G";if(keycode=="51")sentence="iPhone X 256G";if(keycode=="52")sentence="iPhone X 64G";if(keycode=="53")sentence="iPad Pro 10.5' + Apple Pencil";if(keycode=="54")sentence="iPad 128G";var marquee='<marquee direction="left" speed="normal" behavior="loop" class="marquee" id="marquee-top">'+
"<span>"+sentence+"</span>";"<span>"+sentence+"</span>";"<span>"+sentence+"</span>";"</marquee>";$(".marquee-container").html(marquee)})});(function($){$.jSlots=function(el,options){var base=this;base.$el=$(el);base.el=el;base.$el.data("jSlots",base);base.init=function(){base.options=$.extend({},$.jSlots.defaultOptions,options);base.setup();base.bindEvents()};$.jSlots.defaultOptions={number:3,winnerNumber:1,spinner:"",spinEvent:"click",onStart:$.noop,onEnd:$.noop,onWin:$.noop,easing:"swing",time:15E3,loops:10,candidateNumbers:[]};base.randomRange=function(low,high){return Math.floor(Math.random()*(1+high-low))+low};base.isSpinning=false;
base.spinSpeed=0;base.winCount=0;base.doneCount=0;base.$liHeight=0;base.$liWidth=0;base.winners=[];base.allSlots=[];base.luckyNumber="";base.setup=function(){var $list=base.$el;var $li=$list.find("li").first();base.$liHeight=$li.outerHeight();base.$liWidth=$li.outerWidth();base.liCount=base.$el.children().length;base.listHeight=base.$liHeight*base.liCount;base.increment=base.options.time/base.options.loops/base.options.loops;$list.css("position","relative");$li.clone().appendTo($list);base.$wrapper=
$list.wrap('<div class="jSlots-wrapper"></div>').parent();base.$el.remove();for(var i=base.options.number-1;i>=0;i--)base.allSlots.push(new base.Slot)};base.bindEvents=function(){$(base.options.spinner).bind(base.options.spinEvent,function(event){if(!base.isSpinning)base.playSlots()});$(document).keypress(function(e){var keycode=e.keyCode?e.keyCode:e.which;if(keycode=="13")if(!base.isSpinning)base.playSlots()})};base.Slot=function(){this.spinSpeed=0;this.el=base.$el.clone().appendTo(base.$wrapper)[0];
this.$el=$(this.el);this.loopCount=0;this.number=0};base.Slot.prototype={spinElement:function(){var that=this;that.$el.css("top",-base.listHeight).animate({"top":"0px"},that.spinSpeed,"linear",function(){that.lowerSpeed()})},lowerSpeed:function(){this.spinSpeed+=base.increment;this.loopCount++;if(this.loopCount<base.options.loops)this.spinElement();else this.finalLoopRotation()},getLuckyNumber:function(){var endNum;if(base.options.candidateNumbers.length>0&&!base.luckyNumber){var max=base.options.candidateNumbers.length-
1;var randomIndex=base.randomRange(0,max);var number=base.options.candidateNumbers[randomIndex].number;var numberArray=(""+number).split("");base.luckyNumber=number;endNum=numberArray[base.allSlots.indexOf(this)];base.options.candidateNumbers.splice(randomIndex,1);localStorage.setItem("AFTLuckyNumbers2017",JSON.stringify(base.options.candidateNumbers))}else{var numberArray=(""+base.luckyNumber).split("");endNum=numberArray[base.allSlots.indexOf(this)];if(base.allSlots.indexOf(this)==2){if($.isFunction(base.options.onEnd))base.options.onEnd(base.luckyNumber);
setTimeout(function(){base.isSpinning=false;base.luckyNumber=null},6E3)}}return endNum},finalLoopRotation:function(){var that=this;var currentNumber=this.getLuckyNumber();var finalPos=-(base.$liHeight*currentNumber);var finalSpeed=this.spinSpeed*.5*base.liCount/currentNumber;window.finalSpeed=finalSpeed==Infinity?500:finalSpeed;that.$el.css("top",-base.listHeight).animate({"top":finalPos},finalSpeed,base.options.easing)}};base.playSlots=function(){base.isSpinning=true;base.winCount=0;base.doneCount=
0;base.winners=[];if($.isFunction(base.options.onStart))base.options.onStart();$.each(base.allSlots,function(index,val){this.spinSpeed=0;this.loopCount=0;this.spinElement()})};base.init()};$.fn.jSlots=function(options){if(this.length)return this.each(function(){new $.jSlots(this,options)})}})(jQuery);var audio={getEl:function(targetId){var targetEl=document.getElementById(targetId);return targetEl},play:function(targetId){var target=this.getEl(targetId);target.play()},pause:function(targetId){var target=this.getEl(targetId);target.pause()},end:function(targetId){var target=this.getEl(targetId);target.currentTime=0}};$(function(){getAllValidNumbers();function getAllValidNumbers(){var storageNumbers=localStorage.getItem("AFTLuckyNumbers2017");storageNumbers=$.parseJSON(storageNumbers);console.log("getAllValidNumbers : ");console.log(storageNumbers);initSlots(storageNumbers)}var spinnerAudioEl="spinner-audio";var winAudioEl="win-audio";var $lottoBtn=$("#lotto-btn");var $confetti=$("#confetti");function initSlots(validNumbers){$(".slot").jSlots({spinner:"#lotto-btn",candidateNumbers:validNumbers,onStart:function(){$lottoBtn.attr("disabled",
true);$(".slot").find("li").removeClass("winner");audio.play(spinnerAudioEl)},onEnd:function(finalNumbers){console.log("on End");console.log(finalNumbers);var effectDelay=window.finalSpeed;setTimeout(function(){audio.pause(spinnerAudioEl);audio.play(winAudioEl);$confetti.fadeIn("slow")},effectDelay);setTimeout(function(){audio.end(spinnerAudioEl);$lottoBtn.attr("disabled",false);$confetti.fadeOut("slow")},effectDelay+8E3)}})}});
